{"version":3,"sources":["route.js"],"names":["layui","define","exports","utils","localStorage","setItem","getItem","$","_","layer","jquery","_win","undefined","_viewBoxGlobal","this","config","Route","routerViewId","name","routes","router","location","hash","pathname","href","split","prototype","set","options","setRoutes","that","defaults","forEach","item","extend","getTime","random","window","off","on","onChanged","getRoutes","getRoute","route","r","c","component","length","render","renderTarget","callback","_viewBox","NProgress","loadIndex","load","start","randomCode","_view","parent","append","viewId","remove","done","close","isFunction","cb","beforeRender","h","currBoxHeight","height","join","data","html","path","errorMsg","p","params","value","substr","indexOf","index","kv","key"],"mappings":";cAAAA,MAAMC,OAAO,CAAC,QAAS,SAAU,SAAU,YAAa,SAAU,SAASC,GACzE,IAAIC,EAAQH,MAAMG,MADpBH,EAAcG,EAASC,aACrBC,EAAYL,EAAZK,QAAAC,EACEF,EAAqBA,QADvBG,EAEEF,MAAAA,OAFFG,EAGEF,MAAAA,OAHFG,EAIMT,MAAMU,MAJZC,EAKMX,EAAAA,QAEJW,OAPFC,EASIC,EAAAA,WAGFC,KAAKC,OAAS,CADZC,KAAAA,gBACFC,kBAAcL,EACZM,kBAAMN,EACNK,OAAAA,IAEAE,IAAAA,EAAQnB,MAAAoB,OAAAC,SAAAC,MAJIR,KAAdS,cAAAX,IAAAQ,EAAAI,KAAA,IAAAJ,EAAAI,KAAAC,MAAA,KAAA,GAMAX,KAAIM,QAASpB,SAQfgB,EAAMU,UAAUC,IAAM,SAASC,GAC7B,OADFZ,EAAAA,QAAMU,EACOZ,KADSC,OAAAa,GACTd,MAQbE,EAAMU,UAAUG,UAAY,SAASD,GACnC,IAAIE,EAAOhB,KADbE,EAAMU,KAAUG,EAAhBX,MAA4BY,EAASF,OAATV,KAC1BY,EAAIA,OAAOZ,KAAXU,EAAAV,KACAU,IAAAA,EAAeA,CACfE,OAAKf,IAgBF,OAdDI,EAAAA,QAAAA,EAAQY,EAAAH,GADKpB,EAAfwB,QAAAD,EAAAZ,OAAA,SAAAc,GAGEC,EAAAA,IAAO,IAAMH,MAAfI,UAAA,GAAA3B,EAAA4B,OAAA,IAAA,QAGC/B,EAFD0B,EAAAb,KAAAa,EAAAZ,QAGAZ,EAAA8B,QAAAC,IAAA,YAAAC,GAAA,WAAA,WAEEF,EAAQC,WAAIV,EAAeY,WAC3BZ,EAAAY,YAEEZ,EAAAA,WAGDE,GAOLd,EAAMU,UAAUe,UAAY,WAC1B,OAAOnC,EAAQQ,KAAKC,OAAOG,OAM7BF,EAAMU,UAAUgB,SAAW,SAASpB,GAClC,IADII,EACOZ,KADG4B,UACH5B,KADcC,OAAAG,MACzB,GAAIY,MAAAA,EAAJ,CAGER,EAAAA,GAAOV,SAAPU,KACD,IACDA,EADCtB,MAAAoB,OAAAE,GACcD,KAAAA,MAAf,KACIsB,EAAAA,EAAQ3C,KAAMoB,EAAOE,SAAzBsB,GACA,OAAIpB,EAAOmB,OAAMnB,EAAKC,KAEpB,YAAOmB,IAAPC,GAGA,EAAArB,EAAOqB,SACRA,EAAAC,WAAA,IAAAtB,EAAA,GACDqB,EAAIrB,MAAKuB,IAASvB,EAAG,IANrBqB,IAkBF7B,EAAMU,UAAUsB,OAAS,SAAS1B,EAAM2B,EAAcC,GACpD,IAAIpB,EAAOhB,KADbE,EAAMU,EAAUsB,OACdG,OAAWvC,EAAXwC,UAEED,QACF,IAAAE,EAAA5C,EAAA6C,KAAA,GACAF,EAAUG,EAAVC,aACA,GAAIH,GAAJ,EAAgB5C,EAAhBsC,OACAI,EAAahD,MACT8C,CACFE,IAAAA,OAAAvC,IAAWqC,EAAAA,aADb1C,EAAA,eAEOA,EAAA,eAAAQ,EAAAE,cAGL,EAAAwC,EAAAV,SAEEU,EAAAC,SAAAC,OAAA,YAAAC,EAAA,YACAH,EAAMC,SACND,EAAMI,EAAN,IAAAD,GACAT,EAAaA,QAIjBvC,IAAAuC,IACAA,EAAIA,GAEH,IAAAR,EAAAb,EAAAY,SAAApB,GA2FH,SAAIqB,IAEJzC,UAAQ4D,OAtNVT,GAAA5C,EAAAsD,MAAAV,GA6LMlD,EAAM6D,WAAWd,IAAaA,IAEhC,YAhCMC,IAAAA,GACAc,mBAAAA,EAAAA,eACAtB,EAAA5B,EAAAmD,aAAAvB,IAGAA,EAAIwB,QAYJF,EAAAA,KAAAA,gBAAAA,EAAAA,UAAAA,cAAAA,EAAAA,sCAEHtD,EAAA4B,GAAA,SAAA,WApCH,IAqCO6B,EAAA7D,EAAA,eAAA8D,SACLlB,EAAAA,kBAA0BmB,EAA1B,KAAAD,OAAAD,EAAA,KACAhB,SAEDa,KAED9D,EAAS8D,UAAKtB,EAAAG,UAAA,SAAAyB,GACZpB,EAAAqB,KAAAD,GACAnB,IAEAjD,EAAM6D,YAAWd,EAAjBhC,KAA8BgC,IAA9BP,EAAA8B,OACD,SAAAC,GACD,IAAO5C,EAAP,CA/FF,4BAiGA,0BA1BU,+BACA,+BA4BJJ,EACAN,SACAA,SACAI,SACIA,UACJA,KAASmD,IACTC,EAAWnD,KAAF0C,GACTI,QAIFpB,EAAI0B,KArFWnC,CACjB,4BAmBA,4BACE,mCACEC,gCACD,kDACD,sCACA,wCACE,oEACAQ,sEACA,iFACAxC,mBACE,iBACAJ,kDACD,eAhBH,aAkBE0D,WACD,UAkDDK,KAAA,KACAC,UAAAT,OAJFT,GAAA5C,EAAAsD,MAAAV,IAbOvB,GAKTd,EAAMU,UAAUkD,OAAS,WACvB,IAAIxD,EAASpB,MAAMoB,SACnB,QAAoBR,IAAhBQ,EAAOI,KAAoB,OAAO,KACtC,IAAIA,EAAOJ,EAAOI,KACdmD,EAAInD,EAAKsD,OAAOtD,EAAKuD,QAAQ,KAAO,GACxC,GAAIvD,IAASmD,EAAG,OAAO,KACvB,IAAIC,EAASD,EAAElD,MAAM,KACjB8C,EAAO,GAOX,OANA/D,EAAEwB,QAAQ4C,EAAQ,SAAS3C,EAAM+C,GAC/B,IAAIC,EAAKhD,EAAKR,MAAM,KAChByD,EAAMD,EAAG,GACTJ,EAAQI,EAAG,GACfV,EAAKW,GAAOL,IAEPN,GAITrE,EAAQ,QAFI,IAAIc","file":"route.js","sourcesContent":["layui.define(['utils', 'jquery', 'lodash', 'nprogress', 'layer'], function(exports) {\r\n  var utils = layui.utils,\r\n    localStorage = utils.localStorage,\r\n    setItem = localStorage.setItem,\r\n    getItem = localStorage.getItem,\r\n    $ = layui.jquery,\r\n    _ = layui.lodash,\r\n    layer = layui.layer,\r\n    _win = $(window);\r\n\r\n  var _viewBoxGlobal = undefined;\r\n\r\n  var Route = function() {\r\n    this.config = {\r\n      name: 'KITADMINROUTE', // 这个不能改，可能会出问题。\r\n      routerViewId: undefined,\r\n      beforeRender: undefined,\r\n      routes: []\r\n    };\r\n    var router = layui.router(location.hash)\r\n    this.pathname = router.href === undefined ? '/' : router.href.split('?')[0];\r\n    this.version = '1.2.3';\r\n  };\r\n  /**\r\n   * 设置\r\n   * @param {Object} options \r\n   */\r\n  Route.prototype.set = function(options) {\r\n    var that = this;\r\n    $.extend(true, that.config, options);\r\n    return that;\r\n  };\r\n  /**\r\n   * 设置路由\r\n   * @param {*} options \r\n   */\r\n  Route.prototype.setRoutes = function(options) {\r\n    var that = this;\r\n    options.name = options.name || that.config.name;\r\n    that.config.name = options.name;\r\n    var defaults = {\r\n      routes: []\r\n    };\r\n    $.extend(true, defaults, options);\r\n    _.forEach(defaults.routes, function(item) {\r\n      item.id = new Date().getTime() + '' + _.random(1000, 9999);\r\n    });\r\n    // 缓存到本地\r\n    setItem(defaults.name, defaults.routes);\r\n    $(window).off('popstate').on('popstate', function() {\r\n      // 是否由外部处理\r\n      if (utils.isFunction(options.onChanged)) {\r\n        options.onChanged();\r\n      } else {\r\n        that.render();\r\n      }\r\n    });\r\n    return that;\r\n  };\r\n  /**\r\n   * 获取路由\r\n   */\r\n  Route.prototype.getRoutes = function() {\r\n    return getItem(this.config.name);\r\n  };\r\n  /**\r\n   * 获取路由信息\r\n   * @param {*} hash \r\n   */\r\n  Route.prototype.getRoute = function(hash) {\r\n    var that = this;\r\n    var routes = that.getRoutes(that.config.name);\r\n    if (routes === null || routes === undefined) {\r\n      return undefined;\r\n    }\r\n    hash = hash || location.hash;\r\n    var route = layui.router(hash);\r\n    var href = route.href.split('?');\r\n    var c = utils.find(routes, function(r) {\r\n      return r.path === href[0];\r\n    });\r\n    if (c === undefined) {\r\n      return c;\r\n    }\r\n    if (href.length > 1) {\r\n      c.component += '?' + href[1];\r\n      c.path += '?' + href[1];\r\n    }\r\n    return c;\r\n  };\r\n  /**\r\n   * 渲染页面\r\n   * @param {*} hash \r\n   * @param {*} renderTarget \r\n   * @param {*} callback \r\n   */\r\n  Route.prototype.render = function(hash, renderTarget, callback) {\r\n    var that = this,\r\n      config = that.config,\r\n      _viewBox = undefined;\r\n    // 开始\r\n    NProgress.start();\r\n    var loadIndex = layer.load(2);\r\n    var viewId = utils.randomCode();\r\n    if (renderTarget && renderTarget.length > 0) {\r\n      _viewBox = renderTarget;\r\n    } else {\r\n      var _view = config.routerViewId === undefined ?\r\n        $('router-view') : $('router-view#' + config.routerViewId + '');\r\n      // 如果 router-view 标签存在都创建渲染dom,覆盖原来的\r\n      if (_view.length > 0) {\r\n        // 获取id\r\n        _view.parent().append('<div id=\"' + viewId + '\"></div>');\r\n        _view.remove();\r\n        _viewBox = $('#' + viewId);\r\n        _viewBoxGlobal = _viewBox; //缓存一个全局容器 避免单页面的时候 _viewBox 为 undefined\r\n      }\r\n    }\r\n    // 如果是单页面则读取全局\r\n    if (_viewBox === undefined) {\r\n      _viewBox = _viewBoxGlobal;\r\n    }\r\n    var route = that.getRoute(hash);\r\n    var notFoundTpl = [\r\n      '<div class=\"layui-fluid\">',\r\n      '  <div class=\"layui-row\">',\r\n      '    <div class=\"layui-col-xs12\">',\r\n      '      <div class=\"layui-row\">',\r\n      '        <div class=\"layui-col-md4\">&nbsp;</div>',\r\n      '        <div class=\"layui-col-md4\">',\r\n      '          <div class=\"kit-exception\">',\r\n      '            <i class=\"layui-icon kit-exception-icon\">&#xe61c;</i>',\r\n      '            <h3 class=\"kit-exception-title\">:>404 抱歉，你访问的页面不存在</h3>',\r\n      '            <a href=\"javascript:history.back(-1);\" class=\"layui-btn\">返回上一页</a>',\r\n      '          </div>',\r\n      '        </div>',\r\n      '        <div class=\"layui-col-md4\">&nbsp;</div>',\r\n      '      </div>',\r\n      '    </div>',\r\n      '  </div>',\r\n      '</div>'\r\n    ];\r\n    if (route !== undefined) {\r\n      if (typeof config.beforeRender === 'function') {\r\n        route = config.beforeRender(route);\r\n      }\r\n      // 如果是iframe\r\n      if (route.iframe) {\r\n        // _viewBox.html('<div class=\"kit-body-wapper\"><iframe src=\"' + route.component + '\" style=\"height: 780px;\"></iframe></div>');\r\n        _viewBox.html('<iframe src=\"' + route.component + '\" data-id=\"' + viewId + '\" style=\"height: 780px;\"></iframe>');\r\n        // 自适应高度\r\n        _win.on('resize', function() {\r\n          var currBoxHeight = $('.layui-body').height(); //获取当前容器的高度\r\n          $('iframe[data-id=' + viewId + ']').height(currBoxHeight - 3);\r\n        }).resize();\r\n\r\n        cb();\r\n      } else {\r\n        utils.tplLoader(route.component, function(data) {\r\n          _viewBox.html(data);\r\n          cb();\r\n          // 设置浏览器地址显示\r\n          utils.setUrlState(route.name, '#' + route.path);\r\n        }, function(errorMsg) {\r\n          var h = [\r\n            '<div class=\"layui-fluid\">',\r\n            '<div class=\"layui-row\">',\r\n            '<div class=\"layui-col-xs12\">',\r\n            '<div class=\"kit-not-router\">',\r\n            errorMsg,\r\n            '</div>',\r\n            '</div>',\r\n            '</div>',\r\n            '</div>'\r\n          ].join('');\r\n          _viewBox.html(h);\r\n          cb();\r\n        });\r\n      }\r\n    } else {\r\n      _viewBox.html(notFoundTpl.join(''));\r\n      NProgress.done();\r\n      loadIndex && layer.close(loadIndex);\r\n    }\r\n\r\n    function cb() {\r\n      // 结束\r\n      NProgress.done();\r\n      loadIndex && layer.close(loadIndex);\r\n      utils.isFunction(callback) && callback();\r\n    }\r\n    return that;\r\n  };\r\n  /**\r\n   * 获取路由参数\r\n   */\r\n  Route.prototype.params = function() {\r\n    var router = layui.router();\r\n    if (router.href === undefined) return null;\r\n    var href = router.href;\r\n    var p = href.substr(href.indexOf('?') + 1);\r\n    if (href === p) return null;\r\n    var params = p.split('&');\r\n    var data = {};\r\n    _.forEach(params, function(item, index) {\r\n      var kv = item.split('=');\r\n      var key = kv[0];\r\n      var value = kv[1];\r\n      data[key] = value;\r\n    });\r\n    return data;\r\n  };\r\n  var route = new Route();\r\n  //输出router接口\r\n  exports('route', route);\r\n});"]}