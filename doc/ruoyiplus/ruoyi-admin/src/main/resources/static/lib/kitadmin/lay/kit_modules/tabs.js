/** kitadmin-v2.1.6 MIT License By http://kit.zhengjinfan.cn Author Van Zheng */
;"use strict";layui.define(["layer","laytpl","utils","lodash","route"],function(t){layui.layer;var d=layui.jquery,o=layui.laytpl,f=layui.utils,u=layui.lodash,i=f.localStorage,e=layui.route,n="KITADMINTABS",a=".kit-tabs",s=".kit-tab-title",l=".kit-tabs-toolsbox",c=void 0,p=void 0,h=void 0,v={TITLE:['<li lay-id="{{d.id}}" data-path={{d.path}}>','<span title="{{d.title}}">',"{{#if(d.icon){}}",'<i class="layui-icon">{{d.icon}}</i> ',"{{#}}}","{{d.title}}","</span>",'<i class="layui-icon kit-tab-close">&#x1006;</i>',"</li>"].join(""),CONTENT:['<div class="kit-tabs-item" data-path={{d.path}} lay-tab-id="{{d.id}}" data-component="{{d.component}}" data-rendered="{{d.rendered}}">',"<router-view></router-view>","</div>"].join(""),TOOLSITEM:['<li class="kit-item" lay-id="{{d.id}}">','<a href="javascript:;">','<span title="{{d.title}}">{{d.title}}</span>&nbsp;','<i class="layui-icon layui-close">&#x1006;</i>',"</a>","</li>"].join("")},r=function(){this.config={onChangeBefore:void 0,onChanged:void 0,onRendered:void 0},this.version="1.0.2"},y=!1;r.prototype.set=function(t){return d.extend(!0,this.config,t),this},r.prototype.render=function(t){var r=this,i=d(a).attr("kit-target");return p=void 0===p?d(s):p,c=void 0===c?d('div.kit-tabs-content[kit-tabs="'+i+'"]'):c,h=void 0===h?d(l).children("ul"):h,p.children("li").each(function(t,i){var e=d(this),n=e.attr("lay-id");e.off("click").on("click",function(){r.switch(n)});var a=e.find(".kit-tab-close");1===a.length&&a.off("click").on("click",function(t){layui.stope(t),r.remove(n)}),d(l).find(".layui-close").off("click").on("click",function(t){layui.stope(t);var i=d(this).parents(".kit-item").attr("lay-id");r.remove(i)})}),C.prevHandler(),C.nextHandler(),C.toolHandler(),C.toolBoxHandler(r),y||(y=!0,C.initCaches(r)),f.isFunction(t)&&t({tabCount:d(s).children("li").length,isIndex:"#/"===C.findTitle(C.getCurrId()).attr("data-path")}),r},r.prototype.add=function(n,a){var r=this;r.config;if(void 0===n.active){var t=C.getCaches(),i=f.find(t,function(t){return t.path===n.path});if(void 0!==i&&(n.id=i.id),r.exists(n.id))return void r.switch(n.id);if(r.existsByPath(n.path)){var e=r.getByPath(n.path);return void r.switch(e.id)}}else{if(r.exists(n.id))return void r.switch(n.id,!0);if(r.existsByPath(n.path)){e=r.getByPath(n.path);return void r.switch(e.id,!0)}}o(v.TITLE).render(n,function(t){p.append(t),o(v.CONTENT).render(n,function(t){c.append(t),o(v.TOOLSITEM).render(n,function(t){h.append(t);var i=C.getCaches(),e=f.find(i,function(t){return t.path===n.path});void 0===e?i.push({id:n.id,title:n.title,path:n.path,component:n.component,rendered:!1,active:!0,icon:n.icon}):e.id=n.id,C.setCaches(i),r.render(),void 0===n.active?r.switch(n.id):n.active&&r.switch(n.id,!0),f.isFunction(a)&&a()})})})},r.prototype.remove=function(i){var t=C.findTitle(i);if(t.hasClass("layui-this")){var e=t.prev().attr("lay-id");this.switch(e)}t.remove(),C.findContent(i).remove(),C.findTools(i).remove();var n=C.getCaches(),a=n.findIndex(function(t){return t.id===i});n.splice(a,1),C.setCaches(n)},r.prototype.switch=function(i){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=this.config,n=C.findTitle(i);if(0!==n.length){n.width();var a=n[0].offsetLeft,r=p.parent("div.kit-tab").width();if(r<a);var o=n.attr("data-path"),d=C.getCaches(),s=f.find(d,function(t){return t.path===o});if(void 0!==s&&s.active&&t&&(h(),n.click()),!t){h(),u.forEach(d,function(t){t.active=!1});var l=f.find(d,function(t){return t.path===o});void 0!==l&&(l.active=!0),C.setCaches(d);var c=C.getContent(i);c.isRendered||C.renderHTMLForContent(c.elem,c.path)}f.isFunction(e.onChanged)&&e.onChanged(i)}function h(){n.addClass("layui-this").siblings().removeClass("layui-this"),n[0].offsetLeft>n[0].offsetWidth+n.parents("div.kit-tab").width()&&n.parent("ul.kit-tab-title").css("left",-n[0].offsetLeft-n[0].offsetWidth+n.parents("div.kit-tab").width()),C.findContent(i).addClass("layui-show").siblings().removeClass("layui-show"),C.findTools(i).addClass("layui-this").siblings().removeClass("layui-this");var t=C.getContent(i);f.setUrlState(t.path,t.path)}},r.prototype.switchByPath=function(t){var i=C.findTitleByPath(t);0<i.length&&this.switch(i.attr("lay-id"))},r.prototype.exists=function(t){return 0<C.findTitle(t).length},r.prototype.existsByPath=function(t){return 0<C.findTitleByPath(t).length},r.prototype.get=function(t){if(!this.exists(t))return null;var i=C.findTitle(t);return{id:t,title:i.children("span").text(),path:i.attr("data-path"),_content:C.getContent(t)}},r.prototype.getByPath=function(t){if(!this.existsByPath(t))return null;var i=C.findTitleByPath(t),e=i.children("span").text();return{id:i.attr("lay-id"),title:e,path:t}},r.prototype.getCurrId=function(){return C.getCurrId()},r.prototype.init=function(){return C.initCaches(this),this},r.prototype.refresh=function(t){t=t||C.getCurrId();var i=C.getContent(t);C.renderHTMLForContent(i.elem,i.path)};var C={renderHTMLForContent:function(t,i){e.render(i,t,function(){t.attr("data-rendered","true")})},prevHandler:function(){d(".kit-tabs-prev").off("click").on("click",function(){var t=p[0].style.left,i=parseInt(t.substr(0,t.indexOf("px")));0!==i&&(i=0<(i+=d(a).width())?0:i,p.animate({left:i+"px"}))})},nextHandler:function(){d(".kit-tabs-next").off("click").on("click",function(){var t=p[0].style.left,i=parseInt(t.substr(0,t.indexOf("px"))),e=d(a).width(),n=-18;p.children("li").each(function(){var t=d(this).width();n+=t+48}),e<n&&-n<i-e&&(i=0<=i-e?0:i-e,p.animate({left:i+"px"}))})},toolHandler:function(){d(".kit-tabs-tools").off("click").on("click",function(t){layui.stope(t),d(l).show(),d(document).one("click",function(){d(l).hide()})})},toolBoxHandler:function(r){var o=this;d(l).find("li.kit-item").each(function(){var t=d(this),n=t.data("action"),a=t.attr("lay-id");t.off("click").on("click",function(){var t=o.getCurrId();switch(n){case"closeOther":p.find('li:not("[lay-id='+t+']")').each(function(t,i){var e=d(this).attr("lay-id");0!==t&&r.remove(e)});break;case"closeAll":p.find("li:first-child").siblings().each(function(){var t=d(this).attr("lay-id");r.remove(t)});break;case"refresh":var i=C.getContent(t);C.renderHTMLForContent(i.elem,i.path);break;default:var e=C.getContent(a);e.isRendered||C.renderHTMLForContent(e.elem,e.path),r.switch(a)}d(l).hide()})})},initCaches:function(i){var t=this.getCaches();u.forEach(t,function(t){i.add(t)})},findTitle:function(t){return p.children('li[lay-id="'+t+'"]')},findTitleByPath:function(t){return p.children('li[data-path="'+t+'"]')},findContent:function(t){return c.children('div.kit-tabs-item[lay-tab-id="'+t+'"]')},getContent:function(t){var i=this.findContent(t);return{elem:i,component:i.attr("data-component"),path:i.attr("data-path"),isRendered:"true"===i.attr("data-rendered")}},findTools:function(t){return h.find('li.kit-item[lay-id="'+t+'"]')},getCurrId:function(){return p.find("li.layui-this").attr("lay-id")},getCaches:function(){var t=i.getItem(n);return null===t&&(t=[]),t},setCaches:function(t){i.setItem(n,t)}};t("tabs",new r)});
//# sourceMappingURL=tabs.js.map
