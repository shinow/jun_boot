{"version":3,"sources":["cascader.js"],"names":["layui","define","exports","MOD_NAME","$","jquery","layer","utils","_","lodash","laytpl","tpl","_private","renderHTML","data","filter","opts","temps","callback","pid","placeholder","_elem","length","join","render","that","content","isFunction","recursion","temp","datas","this","forEach","item","index","curr","push","value","label","children","id","Cascader","_classCallCheck","config","randomCode","_createClass","key","extend","options","elem","undefined","defaultValues","disabled","onChange","onClick","isObject","warn","isString","console","_input","find","e","stope","_cascaderBox","hasClass","addClass","document","one","e1","removeClass","_item","siblings","selectedData","_child","hasChildren","i","attr","labels","obj","events"],"mappings":"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","file":"cascader.js","sourcesContent":["/**\r\n  扩展一个cascader模块\r\n**/\r\n\r\nlayui.define(['layer', 'utils', 'axios', 'laytpl'], function(exports) { //提示：模块也可以依赖其它模块，如：layui.define('layer', callback);\r\n  const MOD_NAME = 'cascader',\r\n    $ = layui.jquery,\r\n    layer = layui.layer,\r\n    utils = layui.utils,\r\n    _ = layui.lodash,\r\n    laytpl = layui.laytpl;\r\n\r\n  const _private = {\r\n    tpl: [\r\n      '<div class=\"kit-cascader\" kit-filter=\"{{d.filter}}\">',\r\n      '  <div class=\"kit-cascader-title\">',\r\n      '    <span class=\"kit-cascader-show\">{{d.placeholder}}</span>',\r\n      '    <div class=\"kit-icon\">',\r\n      '      <i class=\"layui-icon\">&#xe61a;</i>',\r\n      '    </div>',\r\n      '  </div>',\r\n      '  {{d.content}}',\r\n      '</div>'\r\n    ],\r\n    // 渲染HTML\r\n    renderHTML: function(opts) {\r\n      var that = this;\r\n      const { _elem, data, callback, filter } = opts;\r\n\r\n      var temps = ['<ul class=\"kit-cascader-list\">'];\r\n      var pid = 0; //一级菜单pid为0 ，这是一个约定\r\n      that.recursion(temps, data, pid);\r\n      // 读取input属性\r\n      const { placeholder } = _elem[0];\r\n      _elem.attr('lay-filter', filter);\r\n      if (temps.length > 0) {\r\n        // 闭合ul\r\n        temps.push('</ul>');\r\n        // 渲染页面\r\n        laytpl(that.tpl.join('')).render({\r\n          placeholder: placeholder === '' ? 'Please select' : placeholder,\r\n          content: temps.join(''),\r\n          filter\r\n        }, function(html) {\r\n          _elem.after(html);\r\n          utils.isFunction(callback) && callback();\r\n        });\r\n      }\r\n    },\r\n    // 递归组装dom\r\n    recursion: function(temp, datas, pid) {\r\n      var that = this;\r\n      var curr = [];\r\n      _.forEach(datas, function(item, index) {\r\n        if (item.pid === pid)\r\n          curr.push(item);\r\n      });\r\n      if (curr.length > 0) {\r\n        _.forEach(curr, function(item) {\r\n          temp.push('<li class=\"kit-item\" data-value=\"' + item.value + '\" data-label=\"' + item.label + '\">');\r\n          temp.push('<a href=\"javascript:;\">');\r\n          temp.push('<span>' + item.label + '</span>');\r\n          var children = item.children;\r\n          if (children !== undefined && children !== null && children.length > 0) {\r\n            temp.push('<i class=\"layui-icon\">&#xe602;</i>');\r\n          }\r\n          temp.push('</a>');\r\n          if (children !== undefined && children !== null && children.length > 0) {\r\n            temp.push('<ul class=\"kit-cascader-child layui-anim layui-anim-fadein\">');\r\n            that.recursion(temp, children, item.id);\r\n            temp.push('</ul>');\r\n          }\r\n          temp.push('</li>');\r\n        });\r\n      }\r\n    },\r\n  };\r\n\r\n  class Cascader {\r\n    constructor() {\r\n      this.config = {\r\n        filter: utils.randomCode()\r\n      };\r\n    }\r\n    set(options) {\r\n      $.extend(true, this.config, options);\r\n      return this;\r\n    }\r\n    render(opts) {\r\n      const that = this;\r\n      const config = that.config;\r\n      const options = {\r\n        elem: undefined,\r\n        defaultValues: [],\r\n        disabled: false,\r\n        data: [],\r\n        onChange: undefined,\r\n        onClick: undefined,\r\n        filter: config.filter\r\n      };\r\n      $.extend(true, options, opts);\r\n      if (options.elem === undefined) {\r\n        console.warn('Cascader Error:请为cascader绑定elem.');\r\n        return;\r\n      } else if (utils.isString(options.elem) && $(options.elem).length === 0) {\r\n        console.warn('Cascader Error:请为cascader绑定elem.');\r\n        return;\r\n      } else if (utils.isObject(options.elem) && options.elem.length === 0) {\r\n        console.warn('Cascader Error:请为cascader绑定elem.');\r\n        return;\r\n      } else {\r\n        options.elem = utils.isString(options.elem) ? $(options.elem) : options.elem;\r\n      }\r\n      if (options.elem.length > 1) {\r\n        console.warn('Cascader Error:一次只能渲染一个Cascader.');\r\n        return;\r\n      }\r\n      _private.renderHTML({\r\n        filter: options.filter,\r\n        _elem: options.elem,\r\n        data: [{\r\n          id: 1,\r\n          pid: 0,\r\n          value: '440000',\r\n          label: '广东省',\r\n          children: [{\r\n            id: 2,\r\n            pid: 1,\r\n            value: '440100',\r\n            label: '广州市',\r\n            children: [{\r\n              id: 3,\r\n              pid: 2,\r\n              value: '440106',\r\n              label: '天河区'\r\n            }, {\r\n              id: 4,\r\n              pid: 2,\r\n              value: '440104',\r\n              label: '越秀区'\r\n            }, {\r\n              id: 5,\r\n              pid: 2,\r\n              value: '440105',\r\n              label: '海珠区'\r\n            }]\r\n          }]\r\n        }, {\r\n          id: 11,\r\n          pid: 0,\r\n          value: '510000',\r\n          label: '四川省',\r\n          children: [{\r\n            id: 22,\r\n            pid: 11,\r\n            value: '510100',\r\n            label: '成都市',\r\n            children: [{\r\n              id: 33,\r\n              pid: 22,\r\n              value: '510101',\r\n              label: '市辖区'\r\n            }, {\r\n              id: 44,\r\n              pid: 22,\r\n              value: '510104',\r\n              label: '锦江区'\r\n            }, {\r\n              id: 55,\r\n              pid: 22,\r\n              value: '510105',\r\n              label: '青羊区'\r\n            }]\r\n          }]\r\n        }],\r\n        callback: function() {\r\n          that.bind(options);\r\n        }\r\n      });\r\n    }\r\n    bind(options) {\r\n      var _elem = $('*[kit-filter=' + options.filter + ']');\r\n      var _input = _elem.find('.kit-cascader-show');\r\n      var _cascaderBox = undefined;\r\n      _input.on('click', function(e) {\r\n        layui.stope(e);\r\n        _cascaderBox = _elem.find('.kit-cascader-list');\r\n        if (!_cascaderBox.hasClass('layui-show')) {\r\n          _cascaderBox.addClass('layui-show');\r\n          $(document).one('click', function(e1) {\r\n            layui.stope(e1);\r\n            _cascaderBox.removeClass('layui-show');\r\n          });\r\n        }\r\n      });\r\n      // 处理选项点击事件\r\n      _elem.find('.kit-item').on('click', function(e) {\r\n        layui.stope(e);\r\n        let selectedData = {\r\n          values: [],\r\n          labels: [],\r\n          objs: []\r\n        };\r\n        // 获取当前点击的DOM\r\n        const _item = $(this);\r\n        // 选中当前DOM 移除其他DOM样式\r\n        _item.addClass('layui-this').siblings().removeClass('layui-this');\r\n        // 获取该节点下的子节点\r\n        const _child = _item.children('.kit-cascader-child');\r\n        // 是否存在子节点\r\n        const hasChildren = _child.length > 0;\r\n        if (hasChildren) {\r\n          // 移除其他兄弟节点的选中状态\r\n          _item.siblings().find('.kit-item').removeClass('layui-this');\r\n          // 移除其他兄弟节点的显示状态\r\n          _item.siblings().find('.kit-cascader-child').removeClass('layui-show');\r\n          // 显示当前子节点\r\n          _child.addClass('layui-show');\r\n        } else {\r\n          // 读取选择的数据\r\n          _elem.find('li.layui-this').each(function(i, e) {\r\n            const value = $(this).attr('data-value');\r\n            const label = $(this).attr('data-label');\r\n            selectedData.values.push(value);\r\n            selectedData.labels.push(label);\r\n            selectedData.objs.push({\r\n              value,\r\n              label\r\n            });\r\n          });\r\n          // 隐藏\r\n          _cascaderBox && _cascaderBox.removeClass('layui-show');\r\n          // 赋值\r\n          _input.html(selectedData.labels.join('/'));\r\n          options.elem.val(selectedData.values.join(','));\r\n          //执行事件\r\n          utils.isFunction(options.onChange) && options.onChange({\r\n            elem: options.elem,\r\n            obj: selectedData\r\n          });\r\n        }\r\n        //执行事件\r\n        utils.isFunction(options.onClick) && options.onClick({\r\n          elem: _item,\r\n          obj: {\r\n            value: _item.attr('data-value'),\r\n            label: _item.attr('data-label')\r\n          }\r\n        });\r\n      });\r\n    }\r\n    hello() {\r\n      layer.msg('cccc');\r\n    }\r\n    on(events, callback) {\r\n      return layui.onevent.call(this, MOD_NAME, events, callback);\r\n    }\r\n  }\r\n\r\n  // var cascader = new Cascader();\r\n\r\n  //输出test接口\r\n  exports(MOD_NAME, Cascader);\r\n});"]}